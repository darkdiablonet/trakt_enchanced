<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Configuration - Trakt Enhanced</title>
  <link rel="stylesheet" href="/assets/tailwind.css">
  <link rel="stylesheet" href="/assets/fa/css/all.min.css">
</head>
<body class="loading-body">
  <div class="container mx-auto max-w-2xl p-6">
    <div class="glass rounded-2xl p-8 shadow-2xl">
      <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-white mb-2">
          <i class="fa-solid fa-cog mr-3 text-sky-400"></i>
          Configuration initiale
        </h1>
        <p class="text-gray-300">Configurez votre installation Trakt Enhanced</p>
        <!-- Indicateur CSRF pour debug (masqué par défaut) -->
        <div id="csrf-info" class="text-xs text-gray-500 mt-2 hidden">
          <i class="fa-solid fa-shield-alt mr-1"></i>
          <span id="csrf-status">Sécurité CSRF: <span id="csrf-state">Vérification...</span></span>
        </div>
      </div>

      <div id="alert-container" class="mb-6 hidden">
        <div id="alert" class="p-4 rounded-lg mb-4">
          <div class="flex items-center">
            <i id="alert-icon" class="mr-3"></i>
            <span id="alert-message"></span>
          </div>
        </div>
      </div>

      <form id="setup-form" class="space-y-6">
        <!-- Configuration de base -->
        <div class="space-y-4">
          <h3 class="text-lg font-semibold text-white border-b border-gray-600 pb-2">
            <i class="fa-solid fa-home mr-2 text-sky-400"></i>
            Configuration de base
          </h3>
          
          <div>
            <label for="port" class="block text-sm font-medium text-gray-300 mb-1">Port</label>
            <input type="number" id="port" name="port" value="30009" min="1000" max="65535"
                   class="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-sky-400">
          </div>
        </div>

        <!-- API Trakt -->
        <div class="space-y-4">
          <h3 class="text-lg font-semibold text-white border-b border-gray-600 pb-2">
            <i class="fa-solid fa-tv mr-2 text-green-400"></i>
            API Trakt.tv (Requis)
          </h3>
          <div class="bg-gray-800/50 p-4 rounded-lg mb-4">
            <p class="text-sm text-gray-300 mb-2">
              <i class="fa-solid fa-info-circle mr-2 text-blue-400"></i>
              Pour obtenir vos clés API Trakt :
            </p>
            <ol class="text-sm text-gray-400 space-y-1 ml-4">
              <li>1. Allez sur <a href="https://trakt.tv/oauth/applications" target="_blank" class="text-sky-400 underline">trakt.tv/oauth/applications</a></li>
              <li>2. Créez une nouvelle application</li>
              <li>3. Copiez le Client ID et Client Secret</li>
            </ol>
          </div>
          
          <div>
            <label for="traktClientId" class="block text-sm font-medium text-gray-300 mb-1">Trakt Client ID *</label>
            <input type="text" id="traktClientId" name="traktClientId" required
                   class="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-sky-400" 
                   placeholder="Votre Client ID Trakt">
          </div>
          <div>
            <label for="traktClientSecret" class="block text-sm font-medium text-gray-300 mb-1">Trakt Client Secret *</label>
            <input type="password" id="traktClientSecret" name="traktClientSecret" required
                   class="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-sky-400"
                   placeholder="Votre Client Secret Trakt">
          </div>
        </div>

        <!-- API TMDB -->
        <div class="space-y-4">
          <h3 class="text-lg font-semibold text-white border-b border-gray-600 pb-2">
            <i class="fa-solid fa-film mr-2 text-yellow-400"></i>
            API TMDB (Requis)
          </h3>
          <div class="bg-gray-800/50 p-4 rounded-lg mb-4">
            <p class="text-sm text-gray-300 mb-2">
              <i class="fa-solid fa-info-circle mr-2 text-blue-400"></i>
              Pour obtenir votre clé API TMDB :
            </p>
            <ol class="text-sm text-gray-400 space-y-1 ml-4">
              <li>1. Créez un compte sur <a href="https://www.themoviedb.org/" target="_blank" class="text-sky-400 underline">themoviedb.org</a></li>
              <li>2. Allez dans Paramètres > API</li>
              <li>3. Copiez votre "API Read Access Token"</li>
            </ol>
          </div>
          
          <div>
            <label for="tmdbApiKey" class="block text-sm font-medium text-gray-300 mb-1">TMDB API Key *</label>
            <input type="password" id="tmdbApiKey" name="tmdbApiKey" required
                   class="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-sky-400"
                   placeholder="Votre clé API TMDB">
          </div>
        </div>

        <!-- Sécurité -->
        <div class="space-y-4">
          <h3 class="text-lg font-semibold text-white border-b border-gray-600 pb-2">
            <i class="fa-solid fa-shield-alt mr-2 text-red-400"></i>
            Sécurité
          </h3>
          
          <div>
            <label for="fullRebuildPassword" class="block text-sm font-medium text-gray-300 mb-1">Mot de passe rebuild *</label>
            <input type="password" id="fullRebuildPassword" name="fullRebuildPassword" required
                   class="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-sky-400"
                   placeholder="Mot de passe pour le rebuild complet">
            <p class="text-xs text-gray-400 mt-1">Ce mot de passe sera requis pour forcer un rebuild complet des données</p>
          </div>
        </div>


        <!-- Boutons -->
        <div class="flex gap-4 pt-6">
          <button type="submit" id="submit-btn" 
                  class="flex-1 bg-sky-600 hover:bg-sky-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors flex items-center justify-center">
            <i class="fa-solid fa-save mr-2"></i>
            <span id="submit-text">Créer la configuration</span>
          </button>
          <button type="button" id="retryBtn"
                  class="bg-gray-600 hover:bg-gray-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
            <i class="fa-solid fa-redo mr-2"></i>
            Réinitialiser
          </button>
        </div>
      </form>
    </div>
  </div>

  <script src="/assets/setup.js" data-csrf-token="<!-- CSRF_TOKEN -->"></script>
</body>
</html>